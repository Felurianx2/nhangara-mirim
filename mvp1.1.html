<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nhangara Mirim - MVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
        }
        .game-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 5px 0 #1a6f8a;
            border-width: 2px;
        }
        .game-button:active {
            transform: translateY(3px);
            box-shadow: 0 2px 0 #1a6f8a;
        }
        .dialogue-box {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        .draggable-item {
            cursor: grab;
        }
        .draggable-item:active {
            cursor: grabbing;
        }
        .droppable-area {
            border: 2px dashed transparent;
            transition: all 0.2s ease;
        }
        .droppable-area.drag-over {
            border-color: #facc15; /* yellow-400 */
            transform: scale(1.05);
        }
        .draggable-item-svg {
             pointer-events: none;
        }
    </style>
</head>
<body class="w-full h-screen flex items-center justify-center overflow-hidden">

    <div id="game-container" class="relative w-full max-w-4xl h-[90vh] max-h-[600px] bg-[#87CEEB] rounded-2xl shadow-2xl overflow-hidden border-4 border-white">

        <div id="start-screen" class="w-full h-full flex flex-col items-center justify-center p-8 bg-cover bg-center" style="background-image: url('https://placehold.co/800x600/16a34a/ffffff?text=Mata+Atl%C3%A2ntica');">
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-xl shadow-lg text-center">
                <h1 class="text-4xl font-bold text-green-800 mb-2">Nhangara Mirim</h1>
                <p class="text-green-700 mb-6">Crie seu Guardi√£o para come√ßar a jornada!</p>
                <div id="avatar-preview" class="w-32 h-32 mx-auto mb-4 bg-green-200 rounded-full flex items-center justify-center overflow-hidden border-4 border-white shadow-md"></div>
                <div class="space-y-4 mb-6">
                    <input type="text" id="player-name" class="w-full p-3 rounded-lg border-2 border-green-300 text-center" placeholder="Qual o seu nome?">
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="font-bold text-green-700">Cabelo</label>
                            <select id="avatar-hair" class="w-full p-2 rounded-lg border-2 border-green-300">
                                <option value="#333333">Preto</option>
                                <option value="#A52A2A">Castanho</option>
                                <option value="#D2691E">Loiro</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-bold text-green-700">Olhos</label>
                            <select id="avatar-eyes" class="w-full p-2 rounded-lg border-2 border-green-300">
                                <option value="#333333">Preto</option>
                                <option value="#A0522D">Castanho</option>
                                <option value="#4682B4">Azul</option>
                            </select>
                        </div>
                        <div>
                            <label class="font-bold text-green-700">Roupa</label>
                            <select id="avatar-shirt" class="w-full p-2 rounded-lg border-2 border-green-300">
                                <option value="#34D399">Verde</option>
                                <option value="#FBBF24">Amarelo</option>
                                <option value="#60A5FA">Azul</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button id="start-button" class="game-button w-full bg-yellow-400 text-yellow-900 font-bold py-3 px-6 rounded-lg border-yellow-600 text-xl">Come√ßar Aventura</button>
            </div>
        </div>

        <div id="game-screen" class="hidden w-full h-full relative bg-cover bg-center" style="background-image: url('https://placehold.co/800x600/22c55e/ffffff?text=Hub+da+Mata');">
            <div class="absolute top-2 left-2 right-2 bg-white/70 backdrop-blur-sm p-2 rounded-lg flex justify-between items-center text-sm shadow">
                <div class="font-bold text-green-800" id="game-player-name">Jogador</div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center"><span class="mr-1">üí∞</span><span id="game-coins">0</span> Moedas</div>
                    <div class="flex items-center"><span class="mr-1">‚≠ê</span><span id="game-xp">0</span> XP</div>
                </div>
            </div>
            <div id="game-avatar-container" class="absolute bottom-10 left-1/2 -translate-x-1/2 w-40 h-40"></div>
            <div id="curupira-mentor" class="absolute bottom-10 right-10 w-24 h-32 cursor-pointer hover:scale-110 transition-transform">
                <div id="mission-alert" class="absolute -top-2 -right-2 text-3xl animate-bounce">‚ùó</div>
                <svg viewBox="0 0 100 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="50" cy="30" r="25" fill="#F4A460"/>
                    <path d="M30 60 L 70 60 L 70 110 L 30 110 Z" fill="#228B22"/>
                    <path d="M50 10 L 80 40 L 20 40 Z" fill="#FF4500" transform="rotate(15 50 25)"/>
                    <circle cx="40" cy="30" r="3" fill="black"/>
                    <circle cx="60" cy="30" r="3" fill="black"/>
                    <path d="M45,95 a1,1 0 0,0 10,0" stroke="black" stroke-width="2" fill="none" transform="rotate(180 50 95)"/>
                    <path d="M55,95 a1,1 0 0,0 10,0" stroke="black" stroke-width="2" fill="none" transform="rotate(180 60 95)"/>
                </svg>
            </div>
            <div id="eco-business" class="absolute bottom-10 left-10 w-28 h-28 bg-gray-300 rounded-lg p-2 border-4 border-gray-400">
                <p class="text-xs text-center font-bold">Reciclagem</p>
            </div>
        </div>

        <div id="minigame-screen" class="hidden w-full h-full flex flex-col items-center justify-around bg-green-100 p-4">
            <h2 class="text-2xl font-bold text-green-800">Miss√£o: Separar o Lixo!</h2>
            <p id="minigame-progress" class="text-lg">Coletados: 0 / 10</p>
            <div id="item-spawner" class="w-24 h-24 flex items-center justify-center"></div>
            <div class="w-full flex justify-around">
                <div id="bin-plastico" class="droppable-area w-32 h-40 bg-red-400 rounded-lg flex flex-col items-center justify-center p-2" data-type="plastico">
                    <span class="text-4xl">‚ôªÔ∏è</span><p class="font-bold text-white">Pl√°stico</p>
                </div>
                <div id="bin-organico" class="droppable-area w-32 h-40 bg-yellow-500 rounded-lg flex flex-col items-center justify-center p-2" data-type="organico">
                    <span class="text-4xl">üçé</span><p class="font-bold text-white">Org√¢nico</p>
                </div>
                <div id="bin-metal" class="droppable-area w-32 h-40 bg-blue-500 rounded-lg flex flex-col items-center justify-center p-2" data-type="metal">
                    <span class="text-4xl">ü•´</span><p class="font-bold text-white">Metal</p>
                </div>
            </div>
        </div>

        <div id="dialogue-modal" class="hidden absolute inset-0 bg-black/50 flex items-center justify-center p-4">
            <div class="dialogue-box w-full max-w-lg bg-white rounded-xl shadow-lg p-6 flex items-start space-x-4">
                <div id="dialogue-character" class="w-24 h-24"></div>
                <div class="flex-1">
                    <h3 id="dialogue-title" class="text-xl font-bold mb-2"></h3>
                    <p id="dialogue-text" class="text-gray-700"></p>
                    <button id="dialogue-next" class="game-button mt-4 float-right bg-green-500 text-white font-bold py-2 px-4 rounded-lg border-green-700">Pr√≥ximo</button>
                </div>
            </div>
        </div>
        
        <div id="reward-modal" class="hidden absolute inset-0 bg-black/50 flex items-center justify-center p-4">
            <div class="dialogue-box w-full max-w-sm bg-yellow-200 rounded-xl shadow-lg p-8 text-center border-4 border-yellow-400">
                <h3 id="reward-title" class="text-2xl font-bold mb-4 text-yellow-800"></h3>
                <p id="reward-text" class="text-lg text-yellow-700 mb-6"></p>
                <button id="reward-close" class="game-button bg-yellow-400 text-yellow-900 font-bold py-2 px-6 rounded-lg border-yellow-600">Legal!</button>
            </div>
        </div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {

            const gameState = {
                playerName: "Guardi√£o",
                currentScreen: "start-screen",
                missionsCompleted: 0,
                coins: 0,
                xp: 0,
                avatar: { hair: '#333333', eyes: '#333333', shirt: '#34D399', hasAmulet: false },
                minigame: { score: 0, target: 10, currentItem: null }
            };

            const elements = {
                startScreen: document.getElementById('start-screen'),
                gameScreen: document.getElementById('game-screen'),
                minigameScreen: document.getElementById('minigame-screen'),
                dialogueModal: document.getElementById('dialogue-modal'),
                rewardModal: document.getElementById('reward-modal'),
                startButton: document.getElementById('start-button'),
                playerNameInput: document.getElementById('player-name'),
                avatarPreview: document.getElementById('avatar-preview'),
                avatarHairSelect: document.getElementById('avatar-hair'),
                avatarEyesSelect: document.getElementById('avatar-eyes'),
                avatarShirtSelect: document.getElementById('avatar-shirt'),
                gamePlayerName: document.getElementById('game-player-name'),
                gameCoins: document.getElementById('game-coins'),
                gameXp: document.getElementById('game-xp'),
                gameAvatarContainer: document.getElementById('game-avatar-container'),
                curupiraMentor: document.getElementById('curupira-mentor'),
                missionAlert: document.getElementById('mission-alert'),
                dialogueCharacter: document.getElementById('dialogue-character'),
                dialogueTitle: document.getElementById('dialogue-title'),
                dialogueText: document.getElementById('dialogue-text'),
                dialogueNext: document.getElementById('dialogue-next'),
                rewardTitle: document.getElementById('reward-title'),
                rewardText: document.getElementById('reward-text'),
                rewardClose: document.getElementById('reward-close'),
                itemSpawner: document.getElementById('item-spawner'),
                minigameProgress: document.getElementById('minigame-progress'),
                droppableAreas: document.querySelectorAll('.droppable-area'),
            };

            const svgs = {
                avatar: (hair, eyes, shirt) => `<svg viewBox="0 0 100 100" class="w-full h-full draggable-item-svg"><circle cx="50" cy="50" r="40" fill="#F0DDB3" class="draggable-item-svg"/><path d="M30 20 Q 50 10, 70 20 L 70 40 L 30 40 Z" fill="${hair}" class="draggable-item-svg"/><circle cx="35" cy="50" r="5" fill="${eyes}" class="draggable-item-svg"/><circle cx="65" cy="50" r="5" fill="${eyes}" class="draggable-item-svg"/><path d="M40 70 Q 50 80, 60 70" stroke="black" fill="none" stroke-width="2" class="draggable-item-svg"/><rect x="25" y="85" width="50" height="15" fill="${shirt}" class="draggable-item-svg"/></svg>`,
                saci: `<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="30" fill="#654321"/><circle cx="40" cy="45" r="5" fill="white"/><circle cx="42" cy="46" r="2" fill="black"/><path d="M50 0 L 70 30 L 30 30 Z" fill="red"/></svg>`,
                residuos: {
                    plastico: `<div class="w-20 h-20 draggable-item" data-type="plastico" draggable="true"><svg viewBox="0 0 100 100" class="draggable-item-svg"><path d="M30 90 L 30 40 Q 30 20, 50 20 Q 70 20, 70 40 L 70 90 Z" stroke="blue" stroke-width="2" fill="lightblue"/><rect x="40" y="10" width="20" height="10" fill="blue"/></svg></div>`,
                    organico: `<div class="w-20 h-20 draggable-item" data-type="organico" draggable="true"><svg viewBox="0 0 100 100" class="draggable-item-svg"><path d="M50 20 C 70 20, 80 40, 80 60 C 80 80, 60 90, 50 90 C 40 90, 20 80, 20 60 C 20 40, 30 20, 50 20 Z" fill="green"/><path d="M50 20 L 55 10" stroke="brown" stroke-width="3"/></svg></div>`,
                    metal: `<div class="w-20 h-20 draggable-item" data-type="metal" draggable="true"><svg viewBox="0 0 100 100" class="draggable-item-svg"><rect x="25" y="20" width="50" height="60" rx="10" fill="silver" stroke="gray" stroke-width="2"/></svg></div>`
                }
            };

            let currentDialogue = [];
            let dialogueIndex = 0;

            function startDialogue(dialogue) {
                currentDialogue = dialogue;
                dialogueIndex = 0;
                elements.dialogueTitle.innerText = currentDialogue[dialogueIndex].character;
                elements.dialogueText.innerText = currentDialogue[dialogueIndex].text;
                if (currentDialogue[dialogueIndex].character === "Saci-Perer√™") elements.dialogueCharacter.innerHTML = svgs.saci;
                showElement('dialogue-modal');
            }

            elements.dialogueNext.addEventListener('click', () => {
                dialogueIndex++;
                if (dialogueIndex < currentDialogue.length) {
                    elements.dialogueTitle.innerText = currentDialogue[dialogueIndex].character;
                    elements.dialogueText.innerText = currentDialogue[dialogueIndex].text;
                } else {
                    hideElement('dialogue-modal');
                    const action = currentDialogue[dialogueIndex - 1].onEnd;
                    if (action) action();
                }
            });

            function showElement(id) { document.getElementById(id).classList.remove('hidden'); }
            function hideElement(id) { document.getElementById(id).classList.add('hidden'); }
            function changeScreen(newScreen) {
                hideElement(gameState.currentScreen);
                showElement(newScreen);
                gameState.currentScreen = newScreen;
            }

            function updateUI() {
                const { hair, eyes, shirt } = gameState.avatar;
                elements.avatarPreview.innerHTML = svgs.avatar(hair, eyes, shirt);
                elements.gameAvatarContainer.innerHTML = svgs.avatar(hair, eyes, shirt);
                elements.gamePlayerName.innerText = gameState.playerName;
                elements.gameCoins.innerText = gameState.coins;
                elements.gameXp.innerText = gameState.xp;
                elements.missionAlert.classList.toggle('hidden', gameState.missionsCompleted >= 3);
                elements.gameAvatarContainer.classList.toggle('floating', gameState.avatar.hasAmulet);
            }

            const residuoTypes = ['plastico', 'organico', 'metal'];

            function spawnNewItem() {
                if (gameState.minigame.score >= gameState.minigame.target) {
                    endMinigame();
                    return;
                }
                const randomType = residuoTypes[Math.floor(Math.random() * residuoTypes.length)];
                elements.itemSpawner.innerHTML = svgs.residuos[randomType];
                const draggable = elements.itemSpawner.querySelector('.draggable-item');
                draggable.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.type);
                    setTimeout(() => e.target.classList.add('opacity-50'), 0);
                });
                draggable.addEventListener('dragend', (e) => {
                    e.target.classList.remove('opacity-50');
                });
            }

            function endMinigame() {
                changeScreen('game-screen');
                gameState.missionsCompleted++;
                gameState.coins += 50;
                gameState.xp += 100;

                if (gameState.missionsCompleted < 3) {
                    elements.rewardTitle.innerText = "Miss√£o Completa!";
                    elements.rewardText.innerHTML = `Voc√™ ganhou <strong>+50 Moedas da Mata</strong> e <strong>+100 XP</strong>! <br> Miss√µes Feitas: ${gameState.missionsCompleted}/3`;
                    showElement('reward-modal');
                } else {
                    gameState.avatar.hasAmulet = true;
                    elements.rewardTitle.innerText = "CONQUISTA!";
                    elements.rewardText.innerHTML = `Voc√™ completou 3 miss√µes e conquistou o <strong>Bio-Amuleto da Nascente</strong>! Agora seu avatar pode flutuar.`;
                    showElement('reward-modal');
                }
                updateUI();
            }

            elements.droppableAreas.forEach(area => {
                area.addEventListener('dragover', e => { e.preventDefault(); area.classList.add('drag-over'); });
                area.addEventListener('dragleave', () => area.classList.remove('drag-over'));
                area.addEventListener('drop', e => {
                    e.preventDefault();
                    area.classList.remove('drag-over');
                    const droppedItemType = e.dataTransfer.getData('text/plain');
                    if (droppedItemType === area.dataset.type) {
                        gameState.minigame.score++;
                        elements.minigameProgress.innerText = `Coletados: ${gameState.minigame.score} / ${gameState.minigame.target}`;
                        spawnNewItem();
                    } else {
                        area.classList.add('bg-red-700');
                        setTimeout(() => area.classList.remove('bg-red-700'), 300);
                    }
                });
            });

            function startGame() {
                gameState.playerName = elements.playerNameInput.value || "Guardi√£o";
                updateUI();
                const saciDialogue = [
                    { character: "Saci-Perer√™", text: `Ol√°, ${gameState.playerName}! Sou o Saci. Vejo que voc√™ tem o cora√ß√£o de um Nhangara Mirim, um Jovem Guardi√£o!` },
                    { character: "Saci-Perer√™", text: "A Mata Atl√¢ntica precisa de ajuda. O Curupira, protetor da floresta, tem uma miss√£o para voc√™. Est√° pronto?", onEnd: () => changeScreen('game-screen') }
                ];
                startDialogue(saciDialogue);
            }

            function startMission() {
                const missionText = `Miss√£o ${gameState.missionsCompleted + 1} de 3: A polui√ß√£o avan√ßa. Colete e recicle 10 res√≠duos que est√£o sujando nossa mata.`;
                const curupiraDialogue = [
                     { character: "Curupira", text: missionText, onEnd: () => {
                         gameState.minigame.score = 0;
                         elements.minigameProgress.innerText = `Coletados: 0 / ${gameState.minigame.target}`;
                         changeScreen('minigame-screen');
                         spawnNewItem();
                     }}
                ];
                startDialogue(curupiraDialogue);
            }

            elements.startButton.addEventListener('click', startGame);
            elements.rewardClose.addEventListener('click', () => hideElement('reward-modal'));
            elements.curupiraMentor.addEventListener('click', () => {
                if (gameState.missionsCompleted < 3) {
                    startMission();
                } else {
                     startDialogue([{ character: "Curupira", text: "Voc√™ j√° √© um grande guardi√£o! Seu poder da Nascente o ajudar√° a proteger ainda mais a mata." }]);
                }
            });

            [elements.avatarHairSelect, elements.avatarEyesSelect, elements.avatarShirtSelect].forEach(select => {
                select.addEventListener('change', () => {
                    gameState.avatar.hair = elements.avatarHairSelect.value;
                    gameState.avatar.eyes = elements.avatarEyesSelect.value;
                    gameState.avatar.shirt = elements.avatarShirtSelect.value;
                    updateUI();
                });
            });

            updateUI();
        });
    </script>
</body>
</html>

